This file is a merged representation of a subset of the codebase, containing files not matching ignore patterns, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of a subset of the repository's contents that is considered the most important context.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching these patterns are excluded: node_modules, dist, .git, package-lock.json
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
backend/
  package.json
  server.js
  server.js.backup
frontend/
  public/
    vite.svg
  src/
    assets/
      react.svg
    components/
      ChatView.jsx
      Composer.jsx
      Message.jsx
      Sidebar.jsx
    services/
      api.js
    state/
      chatStore.js
    App.css
    App.jsx
    index.css
    main.jsx
  .gitignore
  eslint.config.js
  index.html
  package.json
  README.md
  vite.config.js
public/
  app.js
  index.html
  style.css
src/
  engines/
    AdvancedDebateEngine.js
    SimpleCouncilEngine.js
  App.jsx
  cache.js
  codeExecutor.js
  index.css
  index.js
  queryClassifier.js
.gitignore
cache.json
LICENSE
package.json
README.md
room-ai-complete-backup.zip
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="frontend/public/vite.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="31.88" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 257"><defs><linearGradient id="IconifyId1813088fe1fbc01fb466" x1="-.828%" x2="57.636%" y1="7.652%" y2="78.411%"><stop offset="0%" stop-color="#41D1FF"></stop><stop offset="100%" stop-color="#BD34FE"></stop></linearGradient><linearGradient id="IconifyId1813088fe1fbc01fb467" x1="43.376%" x2="50.316%" y1="2.242%" y2="89.03%"><stop offset="0%" stop-color="#FFEA83"></stop><stop offset="8.333%" stop-color="#FFDD35"></stop><stop offset="100%" stop-color="#FFA800"></stop></linearGradient></defs><path fill="url(#IconifyId1813088fe1fbc01fb466)" d="M255.153 37.938L134.897 252.976c-2.483 4.44-8.862 4.466-11.382.048L.875 37.958c-2.746-4.814 1.371-10.646 6.827-9.67l120.385 21.517a6.537 6.537 0 0 0 2.322-.004l117.867-21.483c5.438-.991 9.574 4.796 6.877 9.62Z"></path><path fill="url(#IconifyId1813088fe1fbc01fb467)" d="M185.432.063L96.44 17.501a3.268 3.268 0 0 0-2.634 3.014l-5.474 92.456a3.268 3.268 0 0 0 3.997 3.378l24.777-5.718c2.318-.535 4.413 1.507 3.936 3.838l-7.361 36.047c-.495 2.426 1.782 4.5 4.151 3.78l15.304-4.649c2.372-.72 4.652 1.36 4.15 3.788l-11.698 56.621c-.732 3.542 3.979 5.473 5.943 2.437l1.313-2.028l72.516-144.72c1.215-2.423-.88-5.186-3.54-4.672l-25.505 4.922c-2.396.462-4.435-1.77-3.759-4.114l16.646-57.705c.677-2.35-1.37-4.583-3.769-4.113Z"></path></svg>
</file>

<file path="frontend/src/assets/react.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>
</file>

<file path="frontend/src/components/ChatView.jsx">
import Message from "./Message";

export default function ChatView({ messages, loading }) {
  return (
    <div className="chat-view">
      {messages.map((m, i) => (
        <Message key={i} role={m.role} content={m.content} />
      ))}
      {loading && (
        <Message role="assistant" content="Thinkingâ€¦" />
      )}
    </div>
  );
}
</file>

<file path="frontend/src/components/Composer.jsx">
import { useState } from "react";

export default function Composer({ onSend, disabled }) {
  const [value, setValue] = useState("");

  function submit() {
    if (!value.trim()) return;
    onSend(value);
    setValue("");
  }

  return (
    <div className="composer">
      <textarea
        value={value}
        placeholder="Send a message"
        onChange={e => setValue(e.target.value)}
        onKeyDown={e => {
          if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            submit();
          }
        }}
      />
      <button onClick={submit} disabled={disabled}>
        Send
      </button>
    </div>
  );
}
</file>

<file path="frontend/src/components/Message.jsx">
export default function Message({ role, content }) {
  return (
    <div className={`message ${role}`}>
      <div className="bubble">{content}</div>
    </div>
  );
}
</file>

<file path="frontend/src/components/Sidebar.jsx">
export default function Sidebar({
  conversations,
  activeId,
  onSelect,
  onNew
}) {
  return (
    <aside className="sidebar">
      <div className="sidebar-header">
        <span className="logo">room.ai</span>
        <button onClick={onNew}>ï¼‹</button>
      </div>

      <div className="conversation-list">
        {conversations.map(c => (
          <div
            key={c.id}
            className={`conversation ${
              c.id === activeId ? "active" : ""
            }`}
            onClick={() => onSelect(c.id)}
          >
            {c.title}
          </div>
        ))}
      </div>
    </aside>
  );
}
</file>

<file path="frontend/src/services/api.js">
export async function sendPrompt(prompt) {
  const res = await fetch("http://localhost:3000/api/debate", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ prompt })
  });

  if (!res.ok) {
    throw new Error("API error");
  }

  return res.json();
}
</file>

<file path="frontend/src/state/chatStore.js">
import { useState } from "react";

export function useChatStore() {
  const [conversations, setConversations] = useState([
    {
      id: crypto.randomUUID(),
      title: "New chat",
      messages: [
        { role: "assistant", content: "How can I help you today?" }
      ]
    }
  ]);

  const [activeId, setActiveId] = useState(conversations[0].id);

  function newConversation() {
    const convo = {
      id: crypto.randomUUID(),
      title: "New chat",
      messages: []
    };
    setConversations(c => [convo, ...c]);
    setActiveId(convo.id);
  }

  function addMessage(role, content) {
    setConversations(convs =>
      convs.map(c =>
        c.id === activeId
          ? { ...c, messages: [...c.messages, { role, content }] }
          : c
      )
    );
  }

  const activeConversation =
    conversations.find(c => c.id === activeId) || conversations[0];

  return {
    conversations,
    activeConversation,
    activeId,
    setActiveId,
    newConversation,
    addMessage
  };
}
</file>

<file path="frontend/src/App.css">
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}
</file>

<file path="frontend/src/App.jsx">
import { useState } from "react";
import { useChatStore } from "./state/chatStore";
import { sendPrompt } from "./services/api";

import Sidebar from "./components/Sidebar";
import ChatView from "./components/ChatView";
import Composer from "./components/Composer";

export default function App() {
  const {
    conversations,
    activeConversation,
    activeId,
    setActiveId,
    newConversation,
    addMessage
  } = useChatStore();

  const [loading, setLoading] = useState(false);

  async function handleSend(prompt) {
    addMessage("user", prompt);
    setLoading(true);

    try {
      const res = await sendPrompt(prompt);
      addMessage("assistant", res.finalAnswer);
    } catch {
      addMessage("assistant", "Something went wrong.");
    }

    setLoading(false);
  }

  return (
    <div className="app">
      <Sidebar
        conversations={conversations}
        activeId={activeId}
        onSelect={setActiveId}
        onNew={newConversation}
      />

      <main className="main">
        <ChatView
          messages={activeConversation.messages}
          loading={loading}
        />
        <Composer onSend={handleSend} disabled={loading} />
      </main>
    </div>
  );
}
</file>

<file path="frontend/src/index.css">
body {
  margin: 0;
  background: #0f0f0f;
  color: #e5e5e5;
  font-family: system-ui, sans-serif;
}

.app {
  display: flex;
  height: 100vh;
}

.sidebar {
  width: 260px;
  background: #171717;
  display: flex;
  flex-direction: column;
}

.sidebar-header {
  padding: 12px;
  display: flex;
  justify-content: space-between;
}

.logo {
  font-weight: 600;
}

.conversation-list {
  flex: 1;
  overflow-y: auto;
}

.conversation {
  padding: 10px 12px;
  cursor: pointer;
}

.conversation.active {
  background: #262626;
}

.main {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.chat-view {
  flex: 1;
  padding: 24px;
  overflow-y: auto;
}

.message {
  margin-bottom: 12px;
  display: flex;
}

.message.user {
  justify-content: flex-end;
}

.bubble {
  max-width: 700px;
  padding: 12px;
  border-radius: 8px;
  background: #262626;
}

.message.user .bubble {
  background: #2563eb;
}

.composer {
  display: flex;
  gap: 12px;
  padding: 16px;
  border-top: 1px solid #262626;
}

textarea {
  flex: 1;
  resize: none;
  height: 44px;
  background: #171717;
  color: #e5e5e5;
  border: none;
  border-radius: 8px;
  padding: 10px;
}

button {
  background: #2563eb;
  color: white;
  border: none;
  border-radius: 8px;
  padding: 0 18px;
}
</file>

<file path="frontend/src/main.jsx">
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.jsx'

createRoot(document.getElementById('root')).render(
  <StrictMode>
    <App />
  </StrictMode>,
)
</file>

<file path="frontend/.gitignore">
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?
</file>

<file path="frontend/eslint.config.js">
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])
</file>

<file path="frontend/package.json">
{
  "name": "frontend",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "react": "^19.2.0",
    "react-dom": "^19.2.0"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "vite": "npm:rolldown-vite@7.2.5"
  },
  "overrides": {
    "vite": "npm:rolldown-vite@7.2.5"
  }
}
</file>

<file path="frontend/vite.config.js">
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
})
</file>

<file path="public/app.js">
const runBtn = document.getElementById("run");
const promptInput = document.getElementById("prompt");
const output = document.getElementById("output");
const finalAnswerEl = document.getElementById("final-answer");
const transcriptEl = document.getElementById("transcript");

runBtn.addEventListener("click", async () => {
  const prompt = promptInput.value.trim();
  if (!prompt) return;

  runBtn.disabled = true;
  runBtn.textContent = "Running...";
  output.classList.add("hidden");

  try {
    const res = await fetch("/api/debate", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ prompt })
    });

    const data = await res.json();

    finalAnswerEl.textContent = data.finalAnswer || "No answer.";

    transcriptEl.innerHTML = "";
    if (Array.isArray(data.transcript)) {
      data.transcript.forEach(step => {
        const div = document.createElement("div");
        div.className = "reason-step";

        div.innerHTML = `
          <h3>${step.phase.toUpperCase()}</h3>
          <pre>${JSON.stringify(step.output || step, null, 2)}</pre>
        `;
        transcriptEl.appendChild(div);
      });
    }

    output.classList.remove("hidden");
  } catch (err) {
    alert("Something went wrong.");
    console.error(err);
  } finally {
    runBtn.disabled = false;
    runBtn.textContent = "Run";
  }
});
</file>

<file path="public/index.html">
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>room.ai</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <main class="container">
    <header>
      <h1>room.ai</h1>
      <p class="subtitle">AI answers that check themselves</p>
      <span id="mode-badge">MODE: MOCK</span>
    </header>

    <section class="input-section">
      <textarea id="prompt" placeholder="Enter your question or problem here..."></textarea>
      <button id="run">Run</button>
    </section>

    <section id="output" class="output hidden">
      <div class="card">
        <h2>Final Answer</h2>
        <div id="final-answer" class="content"></div>
      </div>

      <div class="card">
        <h2>Reasoning</h2>
        <div id="transcript"></div>
      </div>
    </section>
  </main>

  <script src="app.js"></script>
</body>
</html>
</file>

<file path="public/style.css">
* {
  box-sizing: border-box;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
}

body {
  margin: 0;
  background: #fafafa;
  color: #222;
}

.container {
  max-width: 800px;
  margin: 40px auto;
  padding: 0 20px;
}

header {
  margin-bottom: 30px;
}

h1 {
  margin: 0;
  font-size: 2.2rem;
}

.subtitle {
  margin-top: 4px;
  color: #666;
}

#mode-badge {
  display: inline-block;
  margin-top: 10px;
  padding: 4px 10px;
  font-size: 0.75rem;
  border-radius: 12px;
  background: #eee;
  color: #444;
}

.input-section {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

textarea {
  width: 100%;
  min-height: 140px;
  padding: 12px;
  font-size: 1rem;
  border-radius: 6px;
  border: 1px solid #ccc;
  resize: vertical;
}

button {
  align-self: flex-end;
  padding: 8px 18px;
  font-size: 0.95rem;
  border-radius: 6px;
  border: none;
  background: #222;
  color: white;
  cursor: pointer;
}

button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.output {
  margin-top: 40px;
}

.hidden {
  display: none;
}

.card {
  background: white;
  border: 1px solid #e5e5e5;
  border-radius: 8px;
  padding: 16px;
  margin-bottom: 20px;
}

.card h2 {
  margin-top: 0;
  font-size: 1.2rem;
}

.content {
  line-height: 1.6;
  white-space: pre-wrap;
}

.reason-step {
  margin-bottom: 16px;
}

.reason-step h3 {
  margin-bottom: 6px;
  font-size: 0.95rem;
  color: #444;
}
</file>

<file path="src/engines/AdvancedDebateEngine.js">
import OpenAI from "openai";
import { executeAllCodeBlocks } from "../codeExecutor.js";

export class AdvancedDebateEngine {
  constructor(modelA, modelB, apiKey) {
    this.client = new OpenAI({
      baseURL: "https://openrouter.ai/api/v1",
      apiKey
    });
    this.modelA = modelA;
    this.modelB = modelB;
  }

  async call(model, prompt, maxTokens = 900) {
    const res = await this.client.chat.completions.create({
      model,
      messages: [{ role: "user", content: prompt }],
      temperature: 0.7,
      max_tokens: maxTokens
    });
    return res.choices[0]?.message?.content || "";
  }

  async run(prompt, classification) {
    const transcript = [];
    const start = Date.now();

    const basePrompt = `Solve carefully:\n${prompt}`;

    const [a, b] = await Promise.all([
      this.call(this.modelA, basePrompt),
      this.call(this.modelB, basePrompt)
    ]);

    transcript.push({ phase: "solutions", modelA: a, modelB: b });

    if (classification.enableCodeExecution) {
      transcript.push({
        phase: "execution",
        modelA: await executeAllCodeBlocks(a),
        modelB: await executeAllCodeBlocks(b)
      });
    }

    const critiqueA = await this.call(this.modelA, `Critique:\n${b}`);
    const critiqueB = await this.call(this.modelB, `Critique:\n${a}`);

    transcript.push({ phase: "critique", critiqueA, critiqueB });

    const finalAnswer = await this.call(
      this.modelA,
      `Synthesize the best solution:\n${a}\n${b}\nCritiques:\n${critiqueA}\n${critiqueB}`,
      700
    );

    return {
      success: true,
      finalAnswer,
      transcript,
      metadata: {
        mode: "advanced-debate",
        duration: ((Date.now() - start) / 1000).toFixed(2)
      }
    };
  }
}
</file>

<file path="src/engines/SimpleCouncilEngine.js">
import OpenAI from "openai";
import { executeAllCodeBlocks } from "../codeExecutor.js";
import { getCachedResponse, setCachedResponse } from "../cache.js";

export class SimpleCouncilEngine {
  constructor({ solverModel, verifierModel, apiKey }) {
    this.client = new OpenAI({
      baseURL: "https://openrouter.ai/api/v1",
      apiKey
    });
    this.solverModel = solverModel;
    this.verifierModel = verifierModel;
  }

  getRunMode() {
    return process.env.RUN_MODE || "LIVE";
  }

  mockResponse(role) {
    if (role === "solver") {
      return "Binary search works by halving a sorted search space at each step.";
    }
    if (role === "verifier") {
      return "Correct. Mention the loop invariant explicitly.";
    }
    return "Binary search is correct because it maintains a valid invariant and reduces the search space logarithmically.";
  }

  async call(model, prompt, role) {
    const RUN_MODE = this.getRunMode();

    if (RUN_MODE === "MOCK") {
      return this.mockResponse(role);
    }

    if (RUN_MODE !== "LIVE") {
      return `[${RUN_MODE}] skipped`;
    }

    const res = await this.client.chat.completions.create({
      model,
      messages: [{ role: "user", content: prompt }],
      temperature: 0.3,
      max_tokens: 800
    });

    return res.choices[0]?.message?.content || "";
  }

  async run(prompt, classification) {
    const RUN_MODE = this.getRunMode();

    // ðŸ”¥ CACHE CHECK (LIVE only)
    if (RUN_MODE === "LIVE") {
      const cached = getCachedResponse(prompt);
      if (cached) {
        return {
          ...cached,
          metadata: {
            ...cached.metadata,
            cache: "HIT"
          }
        };
      }
    }

    const transcript = [];
    const start = Date.now();

    const solution = await this.call(this.solverModel, prompt, "solver");
    transcript.push({ phase: "solver", output: solution });

    let executionResults = null;
    if (classification.enableCodeExecution && RUN_MODE === "LIVE") {
      executionResults = await executeAllCodeBlocks(solution);
      transcript.push({ phase: "execution", results: executionResults });
    }

    const verification = await this.call(this.verifierModel, solution, "verifier");
    transcript.push({ phase: "verifier", output: verification });

    const finalAnswer =
      RUN_MODE === "LIVE"
        ? await this.call(this.solverModel, solution + verification, "final")
        : this.mockResponse("final");

    transcript.push({ phase: "final", output: finalAnswer });

    const response = {
      success: true,
      finalAnswer,
      transcript,
      metadata: {
        mode: RUN_MODE,
        duration: ((Date.now() - start) / 1000).toFixed(2),
        cache: "MISS"
      }
    };

    if (RUN_MODE === "LIVE") {
      setCachedResponse(prompt, response);
    }

    return response;
  }
}
</file>

<file path="src/App.jsx">
import { useState } from "react";
import "./index.css";

export default function App() {
  const [messages, setMessages] = useState([
    { role: "assistant", content: "How can I help you today?" }
  ]);
  const [input, setInput] = useState("");
  const [loading, setLoading] = useState(false);

  async function sendMessage() {
    if (!input.trim()) return;

    const userMsg = { role: "user", content: input };
    setMessages(m => [...m, userMsg]);
    setInput("");
    setLoading(true);

    try {
      const res = await fetch("http://localhost:3000/api/debate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ prompt: userMsg.content })
      });

      const data = await res.json();

      setMessages(m => [
        ...m,
        { role: "assistant", content: data.finalAnswer || "No response." }
      ]);
    } catch {
      setMessages(m => [
        ...m,
        { role: "assistant", content: "Error contacting server." }
      ]);
    }

    setLoading(false);
  }

  return (
    <div className="app">
      <aside className="sidebar">
        <div className="logo">room.ai</div>
        <button className="new-chat">+ New chat</button>
      </aside>

      <main className="chat">
        <div className="messages">
          {messages.map((m, i) => (
            <div key={i} className={`message ${m.role}`}>
              {m.content}
            </div>
          ))}
          {loading && (
            <div className="message assistant">Thinkingâ€¦</div>
          )}
        </div>

        <div className="input-bar">
          <textarea
            placeholder="Send a message"
            value={input}
            onChange={e => setInput(e.target.value)}
            onKeyDown={e => {
              if (e.key === "Enter" && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
              }
            }}
          />
          <button onClick={sendMessage}>Send</button>
        </div>
      </main>
    </div>
  );
}
</file>

<file path="src/cache.js">
import fs from "fs";
import crypto from "crypto";

const CACHE_FILE = "./cache.json";

function loadCache() {
  if (!fs.existsSync(CACHE_FILE)) {
    fs.writeFileSync(CACHE_FILE, JSON.stringify({}), "utf-8");
  }
  return JSON.parse(fs.readFileSync(CACHE_FILE, "utf-8"));
}

function saveCache(cache) {
  fs.writeFileSync(CACHE_FILE, JSON.stringify(cache, null, 2), "utf-8");
}

function hashPrompt(prompt) {
  return crypto.createHash("sha256").update(prompt).digest("hex");
}

export function getCachedResponse(prompt) {
  const cache = loadCache();
  const key = hashPrompt(prompt);
  return cache[key] || null;
}

export function setCachedResponse(prompt, response) {
  const cache = loadCache();
  const key = hashPrompt(prompt);
  cache[key] = response;
  saveCache(cache);
}
</file>

<file path="src/index.css">
:root {
  --bg: #ffffff;
  --bg-panel: #f4f4f4;
  --bg-message: #e5e5e5;
  --bg-user: #2563eb;

  --text: #111111;
  --text-muted: #555555;
  --border: #dddddd;
}

[data-theme="dark"] {
  --bg: #0f0f0f;
  --bg-panel: #171717;
  --bg-message: #262626;
  --bg-user: #2563eb;

  --text: #e5e5e5;
  --text-muted: #aaaaaa;
  --border: #262626;
}

body {
  margin: 0;
  background: var(--bg);
  color: var(--text);
  font-family: system-ui, sans-serif;
  transition: background 0.25s ease, color 0.25s ease;
}


.app {
  display: flex;
  height: 100vh;
}

.sidebar {
  width: 260px;
  background: #171717;
  padding: 16px;
  display: flex;
  flex-direction: column;
}

.logo {
  font-size: 1.2rem;
  font-weight: 600;
  margin-bottom: 16px;
}

.new-chat {
  background: #262626;
  border: none;
  color: #e5e5e5;
  padding: 8px;
  border-radius: 6px;
  cursor: pointer;
}

.chat {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.messages {
  flex: 1;
  padding: 24px;
  overflow-y: auto;
}

.message {
  max-width: 720px;
  padding: 12px 14px;
  margin-bottom: 12px;
  border-radius: 8px;
  line-height: 1.5;
  white-space: pre-wrap;
}

.message.user {
  background: #2563eb;
  align-self: flex-end;
}

.message.assistant {
  background: #262626;
  align-self: flex-start;
}

.input-bar {
  padding: 16px;
  border-top: 1px solid #262626;
  display: flex;
  gap: 12px;
}

textarea {
  flex: 1;
  resize: none;
  height: 44px;
  border-radius: 8px;
  border: none;
  padding: 10px;
  font-size: 1rem;
  background: #171717;
  color: #e5e5e5;
}

textarea:focus {
  outline: none;
}

button {
  background: #2563eb;
  border: none;
  color: white;
  padding: 0 18px;
  border-radius: 8px;
  cursor: pointer;
}
</file>

<file path="cache.json">
{
  "cd251e2050be50c8c6ca69738c9fac468c71b15e6ec40a227608d44072c8ef44": {
    "success": true,
    "finalAnswer": "Binary search is correct because it maintains a valid invariant and reduces the search space logarithmically.",
    "transcript": [
      {
        "phase": "solver",
        "output": "Binary search works by halving a sorted search space at each step."
      },
      {
        "phase": "verifier",
        "output": "Correct. Mention the loop invariant explicitly."
      },
      {
        "phase": "final",
        "output": "Binary search is correct because it maintains a valid invariant and reduces the search space logarithmically."
      }
    ],
    "metadata": {
      "mode": "MOCK",
      "duration": "0.00",
      "cache": "MISS"
    }
  }
}
</file>

<file path="backend/server.js.backup">
const express = require('express');
const cors = require('cors');
const app = express();

app.use(cors());
app.use(express.json());

app.get('/health', (req, res) => res.json({status: 'alive'}));
app.post('/api/debate', (req, res) => {
  res.json({
    finalAnswer: `âœ… **Room AI IS WORKING!**\n\nYour question: "${req.body.prompt || 'test'}"\n\n**Backend stable and ready for Render deploy!** ðŸš€`,
    models: {modelA: 'Llama', modelB: 'Mistral'},
    debateSteps: [{stage: 'Test', status: 'complete'}]
  });
});

const PORT = 3000;
app.listen(PORT, () => {
  console.log(`âœ… Server running on ${PORT}`);
});
</file>

<file path="frontend/README.md">
# React + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) (or [oxc](https://oxc.rs) when used in [rolldown-vite](https://vite.dev/guide/rolldown)) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## React Compiler

The React Compiler is not enabled on this template because of its impact on dev & build performances. To add it, see [this documentation](https://react.dev/learn/react-compiler/installation).

## Expanding the ESLint configuration

If you are developing a production application, we recommend using TypeScript with type-aware lint rules enabled. Check out the [TS template](https://github.com/vitejs/vite/tree/main/packages/create-vite/template-react-ts) for information on how to integrate TypeScript and [`typescript-eslint`](https://typescript-eslint.io) in your project.
</file>

<file path="src/queryClassifier.js">
// Smart Query Classification System
// Determines task type and REQUIRED complexity (not debate intensity)

function classifyQuery(prompt) {
  const promptLower = prompt.toLowerCase();

  const codeKeywords = [
    'write a function', 'write code', 'implement', 'algorithm',
    'debug', 'fix this code', 'program', 'script', 'class',
    'codeforces', 'leetcode', 'solve:', 'java', 'python', 'c++',
    'javascript', 'function to', 'method to'
  ];

  const creativeKeywords = [
    'story', 'poem', 'creative', 'imagine', 'brainstorm',
    'design', 'fiction', 'narrative'
  ];

  const analyticalKeywords = [
    'analyze', 'compare', 'evaluate', 'pros and cons',
    'which is better', 'should i', 'worth it'
  ];

  const isCode = codeKeywords.some(k => promptLower.includes(k));
  const isCreative = creativeKeywords.some(k => promptLower.includes(k));
  const isAnalytical = analyticalKeywords.some(k => promptLower.includes(k));

  if (isCode) {
    return {
      type: 'code',
      complexity: 'high',
      enableCodeExecution: true
    };
  }

  if (isAnalytical) {
    return {
      type: 'analytical',
      complexity: 'medium',
      enableCodeExecution: false
    };
  }

  if (isCreative) {
    return {
      type: 'creative',
      complexity: 'low',
      enableCodeExecution: false
    };
  }

  return {
    type: 'general',
    complexity: 'low',
    enableCodeExecution: false
  };
}

export { classifyQuery };
</file>

<file path="LICENSE">
MIT License

Copyright (c) 2025 Room AI

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
</file>

<file path="README.md">
# room-ai
Multi-LLM Debate &amp; Collaboration Engine
</file>

<file path="src/codeExecutor.js">
// Code Execution Service using Piston API (Free)
import axios from 'axios';

const PISTON_API = 'https://emkc.org/api/v2/piston';

// Language mapping
const LANGUAGE_MAP = {
    'python': { language: 'python', version: '3.10.0' },
    'javascript': { language: 'javascript', version: '18.15.0' },
    'java': { language: 'java', version: '15.0.2' },
    'cpp': { language: 'cpp', version: '10.2.0' },
    'c': { language: 'c', version: '10.2.0' },
    'go': { language: 'go', version: '1.16.2' },
    'rust': { language: 'rust', version: '1.68.2' }
};

// Extract code blocks from markdown text
function extractCodeBlocks(text) {
    const codeBlocks = [];
    
    // Match code blocks with language specification: ``````
    const blockRegex = /``````/g;
    let match;
    
    while ((match = blockRegex.exec(text)) !== null) {
        const language = (match[1] || 'python').toLowerCase();
        const code = match[2].trim();
        
        if (code) {
            codeBlocks.push({
                language: language,
                code: code,
                raw: match[0]
            });
        }
    }
    
    return codeBlocks;
}

// Execute code using Piston API
async function executeCode(code, language = 'python', stdin = '') {
    try {
        const langConfig = LANGUAGE_MAP[language.toLowerCase()] || LANGUAGE_MAP['python'];
        
        const response = await axios.post(`${PISTON_API}/execute`, {
            language: langConfig.language,
            version: langConfig.version,
            files: [{
                content: code
            }],
            stdin: stdin,
            compile_timeout: 10000,
            run_timeout: 3000,
            compile_memory_limit: -1,
            run_memory_limit: -1
        });
        
        return {
            success: true,
            output: response.data.run.stdout || response.data.run.stderr || 'No output',
            exitCode: response.data.run.code,
            language: language,
            executionTime: response.data.run.runtime || 'N/A'
        };
    } catch (error) {
        return {
            success: false,
            output: error.message,
            error: error.message,
            language: language,
            exitCode: 1
        };
    }
}

// Execute all code blocks found in text
async function executeAllCodeBlocks(text, stdin = '') {
    const codeBlocks = extractCodeBlocks(text);
    
    if (codeBlocks.length === 0) {
        return null;
    }
    
    const results = [];
    
    for (const block of codeBlocks) {
        const result = await executeCode(block.code, block.language, stdin);
        results.push({
            ...result,
            originalCode: block.code
        });
    }
    
    return results;
}

// Generate test cases for code
function generateTestCases(problemDescription) {
    // Common edge cases for different problem types
    const edgeCases = {
        array: [
            '[]',
            '[1]',
            '[1,1,1,1]',
            '[5,4,3,2,1]',
            '[-1,-5,0,10]'
        ],
        number: [
            '0',
            '1',
            '-1',
            '1000000',
            '-1000000'
        ],
        string: [
            '""',
            '"a"',
            '"aaa"',
            '"Hello World"'
        ]
    };
    
    return edgeCases;
}

export { executeCode, extractCodeBlocks, executeAllCodeBlocks, generateTestCases };
</file>

<file path=".gitignore">
# Dependencies
node_modules/
package-lock.json

# Environment
.env
.env.local

# Build
dist/
build/

# IDE
.vscode/
.idea/
*.swp
*.swo

# OS
.DS_Store
Thumbs.db

# Logs
*.log
npm-debug.log*

# Cache
.cache/

# API Keys - NEVER COMMIT
.env
backend/.env
**/.env
</file>

<file path="backend/package.json">
{
  "name": "room-ai-backend",
  "version": "1.0.0",
  "description": "Multi-Agent AI Debate Backend",
  "main": "server.js",
  "scripts": {
    "start": "node server.js",
    "dev": "node server.js"
  },
  "keywords": [
    "ai",
    "debate",
    "groq"
  ],
  "author": "",
  "license": "MIT",
  "dependencies": {
    "axios": "^1.13.2",
    "cors": "^2.8.5",
    "dotenv": "^16.3.1",
    "express": "^4.22.1",
    "groq-sdk": "^0.3.0",
    "openai": "^6.15.0"
  }
}
</file>

<file path="package.json">
{
  "name": "room-ai",
  "version": "1.0.0",
  "type": "module",
  "main": "src/index.js",
  "scripts": {
    "start": "node src/index.js",
    "dev": "node --watch src/index.js"
  },
  "dependencies": {
    "@huggingface/inference": "^4.13.4",
    "axios": "^1.13.2",
    "cors": "^2.8.5",
    "dotenv": "^16.3.1",
    "express": "^4.18.2",
    "openai": "^6.9.1"
  }
}
</file>

<file path="src/index.js">
import express from "express";
import dotenv from "dotenv";
import cors from "cors";

import { classifyQuery } from "./queryClassifier.js";
import { SimpleCouncilEngine } from "./engines/SimpleCouncilEngine.js";
import { AdvancedDebateEngine } from "./engines/AdvancedDebateEngine.js";

dotenv.config();

const app = express();
app.use(express.json());
app.use(express.static("public"));
app.use(cors());

const RUN_MODE = process.env.RUN_MODE || "LIVE";
const ADVANCED_MODE = process.env.ADVANCED_MODE === "true";

const MODELS = {
  modelA: "meta-llama/llama-3.3-70b-instruct:free",
  modelB: "mistralai/mistral-7b-instruct:free"
};

/* ===================== ROUTES ===================== */

app.get("/", (req, res) => {
  res.json({
    project: "ï¿½ï¿½ï¸ room.ai",
    description: "Multi-LLM Debate & Collaboration Engine",
    status: "online",
    version: "3.0.0",
    runMode: RUN_MODE,
    advancedMode: ADVANCED_MODE
  });
});

app.post("/api/debate", async (req, res) => {
  try {
    const { prompt } = req.body;

    if (!prompt) {
      return res.status(400).json({
        success: false,
        error: "Prompt is required"
      });
    }

    const classification = classifyQuery(prompt);

    const engine =
      ADVANCED_MODE && RUN_MODE === "LIVE"
        ? new AdvancedDebateEngine(
            MODELS.modelA,
            MODELS.modelB,
            process.env.OPENROUTER_API_KEY
          )
        : new SimpleCouncilEngine({
            solverModel: MODELS.modelA,
            verifierModel: MODELS.modelB,
            apiKey: process.env.OPENROUTER_API_KEY
          });

    const result = await engine.run(prompt, classification);
    res.json({ ...result, classification });
  } catch (err) {
    console.error("Debate error:", err);
    res.status(500).json({
      success: false,
      error: err.message || "Internal server error"
    });
  }
});

app.get("/models", (req, res) => {
  res.json({
    available: MODELS,
    provider: "OpenRouter"
  });
});

app.get("/health", (req, res) => {
  res.json({
    status: "healthy",
    uptime: process.uptime(),
    timestamp: new Date().toISOString()
  });
});

/* ===================== START ===================== */

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(`ðŸš€ room.ai running on http://localhost:${PORT}`);
  console.log(`MODE: ${RUN_MODE} | ADVANCED: ${ADVANCED_MODE}`);
});
</file>

<file path="frontend/index.html">
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>frontend</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
</file>

<file path="backend/server.js">
const express = require('express');
const cors = require('cors');
const app = express();
app.use(cors());
app.use(express.json());

app.post('/api/debate', async (req, res) => {
  console.log('ðŸ“¥ REQUEST:', req.body);
  
  const { prompt, model = 'deepseek-r1:free' } = req.body;
  console.log('ðŸ”¥ MODEL:', model, 'PROMPT:', prompt);
  
  if (!process.env.OPENROUTER_API_KEY) {
    return res.status(500).json({ error: 'NO API KEY' });
  }
  
  try {
    console.log('ðŸŒ CALLING OPENROUTER...');
    const apiResp = await fetch('https://openrouter.ai/api/v1/chat/completions', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${process.env.OPENROUTER_API_KEY}`,
        'Content-Type': 'application/json',
        'HTTP-Referer': 'https://room-ai.onrender.com'
      },
      body: JSON.stringify({
        model: model,
        messages: [{role: 'user', content: prompt}]
      })
    });
    
    console.log('ðŸ“¡ STATUS:', apiResp.status);
    const data = await apiResp.json();
    console.log('ðŸ” FULL RESPONSE:', JSON.stringify(data, null, 2));
    
    res.json({ 
      response: data.choices?.[0]?.message?.content || data.error || 'ERROR',
      model_used: model 
    });
  } catch (error) {
    console.error('ðŸ’¥ ERROR:', error);
    res.status(500).json({ error: error.message });
  }
});

app.listen(3000, () => console.log('âœ… Server OK'));
</file>

</files>
